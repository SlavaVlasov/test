procedure TForm1.WMDropFiles(var Msg: TWMDropFiles);
const
  MAXFILENAME = 255;
var
  i: integer;
  fileCount: integer;
  fileName: array[0..MAXFILENAME] of Char;
begin
  if DragQueryFile(Msg.Drop, $FFFFFFFF, nil, 0) <> 0 then
  begin
    Application.MessageBox(PChar('Ошибка при перетаскивании файлов'), PChar('Ошибка'), MB_OK);
  end
  else
  begin
  { Сколько файлов перетаскивать }
    fileCount := DragQueryFile(Msg.Drop, $FFFFFFFF, fileName, MAXFILENAME);
  { Связываем с именами файлов }
    if fileCount = 1 then                                                         //ЕСЛИ ПЕРЕТАСКИВАЕМ ОДИН ФАЙЛ
    begin
      if DragQuene = 0 then                                                       //Если счетчик - в нуле
      begin                                                                       //Добавляем первый файл в списке переноса в первое поле
        DragQueryFile(Msg.Drop, 0, fileName, MAXFILENAME);
        Edit1.Text := fileName;
        Label1.Caption := FSize(Edit1.Text) + ' байт';
        Label1.Hint := FSize(Edit1.Text) + ' байт';
        Edit1.SetFocus;
        Edit1.SelStart := Length(Edit1.Text);
        DragQuene := DragQuene + 1;                                               //Добавляем +1 к очереди, чтобы файл добавлялся в следующее поле, кроме первого
      end
      else if DragQuene = 1 then                                                  //Если счетчик 1 (в первое поле уже что-то добавлено)
      begin
        DragQueryFile(Msg.Drop, 0, fileName, MAXFILENAME);                        //Добавляем первый файл в списке переноса во второе поле
        Edit2.Text := fileName;
        Label2.Caption := FSize(Edit2.Text) + ' байт';
        Label2.Hint := FSize(Edit2.Text) + ' байт';
        Edit2.SetFocus;
        Edit2.SelStart := Length(Edit2.Text);
        DragQuene := DragQuene + 1;                                               //Добавляем +1 к очереди, чтобы файл добавлялся в следующее поле, кроме первого и второго
      end
      else if DragQuene = 2 then                                                  //Если счетчик 2 (в первое и второе поле уже что-то добавлено)
      begin
        DragQueryFile(Msg.Drop, 0, fileName, MAXFILENAME);                        //Добавляем первый файл в списке переноса во третье поле
        Edit3.Text := fileName;
        Label3.Caption := FSize(Edit3.Text) + ' байт';
        Label3.Hint := FSize(Edit3.Text) + ' байт';
        Edit3.SetFocus;
        Edit3.SelStart := Length(Edit3.Text);
        DragQuene := 0;                                                           //Сбрасываем счетчик (теперь файлы снова начнут добавляться с первого поля
      end;

    end
    else if fileCount = 2 then                                                    //ЕСЛИ ПЕРЕТАСКИВАЕМ ДВА ФАЙЛА
    begin
      if DragQuene = 0 then                                                       //Если счетчик - в нуле
      begin
        DragQueryFile(Msg.Drop, 0, fileName, MAXFILENAME);                        //Добавляем первый файл в списке переноса в первое поле
        Edit1.Text := fileName;
        Label1.Caption := FSize(Edit1.Text) + ' байт';
        Label1.Hint := FSize(Edit1.Text) + ' байт';
        Edit1.SetFocus;
        Edit1.SelStart := Length(Edit1.Text);

        DragQueryFile(Msg.Drop, 1, fileName, MAXFILENAME);                        //Добавляем второй файл в списке переноса во второе поле
        Edit2.Text := fileName;
        Label2.Caption := FSize(Edit2.Text) + ' байт';
        Label2.Hint := FSize(Edit2.Text) + ' байт';
        Edit2.SetFocus;
        Edit2.SelStart := Length(Edit2.Text);

        DragQuene := DragQuene + 2;                                               //Добавляем +2 к очереди, чтобы файл добавлялся в следующее поле, кроме первого и второго
      end
      else if DragQuene = 1 then                                                  //Если счетчик 1 (в первое поле уже что-то добавлено)
      begin
        DragQueryFile(Msg.Drop, 0, fileName, MAXFILENAME);                        //Добавляем первый файл в списке переноса во ВТОРОЕ поле
        Edit2.Text := fileName;
        Label2.Caption := FSize(Edit2.Text) + ' байт';
        Label2.Hint := FSize(Edit2.Text) + ' байт';
        Edit2.SetFocus;
        Edit2.SelStart := Length(Edit2.Text);

        DragQueryFile(Msg.Drop, 1, fileName, MAXFILENAME);                        //Добавляем второй файл в списке переноса во ТРЕТЬЕ поле
        Edit3.Text := fileName;
        Label3.Caption := FSize(Edit3.Text) + ' байт';
        Label3.Hint := FSize(Edit3.Text) + ' байт';
        Edit3.SetFocus;
        Edit3.SelStart := Length(Edit3.Text);

        DragQuene := 0;                                                           //Сбрасываем счетчик (теперь файлы снова начнут добавляться с первого поля

      end
      else if DragQuene = 2 then                                                  //Если счетчик 2 (в первое и второе поле уже что-то добавлено)
      begin
        DragQueryFile(Msg.Drop, 0, fileName, MAXFILENAME);                        //Добавляем первый файл в списке переноса во третье поле
        Edit3.Text := fileName;
        Label3.Caption := FSize(Edit3.Text) + ' байт';
        Label3.Hint := FSize(Edit3.Text) + ' байт';
        Edit3.SetFocus;
        Edit3.SelStart := Length(Edit3.Text);
        DragQuene := 0;                                                           //Сбрасываем счетчик (теперь файлы снова начнут добавляться с первого поля
      end;
    end
    else if fileCount >= 3 then                                                   //ЕСЛИ ПЕРЕТАСКИВАЕМ ТРИ ИЛИ БОЛЕЕ ФАЙЛОВ, БЕРЕМ ТОЛЬКО ПЕРВЫЕ ТРИ
    begin
      DragQueryFile(Msg.Drop, 0, fileName, MAXFILENAME);                          //Добавляем первый файл в списке переноса в первое поле
      Edit1.Text := fileName;
      Label1.Caption := FSize(Edit1.Text) + ' байт';
      Label1.Hint := FSize(Edit1.Text) + ' байт';
      Edit1.SetFocus;
      Edit1.SelStart := Length(Edit1.Text);

      DragQueryFile(Msg.Drop, 1, fileName, MAXFILENAME);                          //Добавляем второй файл в списке переноса во второе поле
      Edit2.Text := fileName;
      Label2.Caption := FSize(Edit2.Text) + ' байт';
      Label2.Hint := FSize(Edit2.Text) + ' байт';
      Edit2.SetFocus;
      Edit2.SelStart := Length(Edit2.Text);

      DragQueryFile(Msg.Drop, 2, fileName, MAXFILENAME);                          //Добавляем третий файл в списке переноса в третье поле
      Edit3.Text := fileName;
      Label3.Caption := FSize(Edit3.Text) + ' байт';
      Label3.Hint := FSize(Edit3.Text) + ' байт';
      Edit3.SetFocus;
      Edit3.SelStart := Length(Edit3.Text);

      DragQuene := 0;                                                             //На всякий случай сбрасываем счетчик
    {Остальные файлы игнорируем}
    end;

  { Освобождаем память }
    DragFinish(Msg.Drop);
  end;
end;
